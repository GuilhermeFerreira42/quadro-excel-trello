<!-- 
  Projeto Calendário - Interface inspirada no Trello com recursos de planilha
  - Usa TailwindCSS para estilização
  - FontAwesome para ícones
  - Layout responsivo e moderno
-->
<html lang="pt-BR" class="scroll-smooth" style="scroll-behavior:smooth">
<head>
  <!-- Meta tags para responsividade e encoding -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calendário - Trello Clone</title>
  
  <!-- Dependências externas -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />

  <style>
    /* Customização da scrollbar para barra lateral */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    ::-webkit-scrollbar-thumb {
      background-color: #4b5563;
      border-radius: 4px;
    }
    ::-webkit-scrollbar-track {
      background: transparent;
    }

    /* Scrollbar horizontal para conteúdo principal */
    .scrollbar-x::-webkit-scrollbar {
      height: 8px;
    }
    .scrollbar-x::-webkit-scrollbar-thumb {
      background-color: #4b5563;
      border-radius: 4px;
    }
    .scrollbar-x::-webkit-scrollbar-track {
      background: transparent;
    }

    /* Fundo do modal */
    .modal-bg {
      background-color: rgba(0, 0, 0, 0.6);
    }

    /* Posicionamento do menu dropdown para três pontos */
    .dropdown-menu {
      position: absolute;
      z-index: 9999;
      background-color: #1b1c21;
      border: 1px solid #2f2f33;
      border-radius: 0.375rem;
      box-shadow: 0 4px 8px rgb(0 0 0 / 0.5);
      width: 10rem;
      font-size: 0.75rem;
      display: none;
      flex-direction: column;
    }
    .dropdown-menu button {
      padding: 0.5rem 1rem;
      text-align: left;
      color: #9ca3af;
      background: transparent;
      border: none;
      cursor: pointer;
      width: 100%;
    }
    .dropdown-menu button:hover {
      background-color: #2f2f33;
      color: white;
    }

    /* Barra lateral colapsada */
    .sidebar-collapsed {
      width: 0 !important;
      overflow: hidden !important;
      padding: 0 !important;
      margin: 0 !important;
      border: none !important;
      visibility: hidden !important;
      opacity: 0 !important;
      transition: all 0.3s ease-in-out !important;
    }
    
    .sidebar-collapsed * {
      display: none !important;
    }

    /* Botão de alternância da barra lateral */
    #sidebarToggleBtn {
      position: fixed;
      top: 3rem;
      left: 0;
      background-color: #1b1c21;
      border: 1px solid #2f2f33;
      border-radius: 0 0.375rem 0.375rem 0;
      width: 1.5rem;
      height: 3rem;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 1000;
      color: white;
      transition: background-color 0.2s ease;
    }
    #sidebarToggleBtn:hover {
      background-color: #2f2f33;
    }

    /* Altura mínima e crescimento do conteúdo principal */
    #boardContent {
      min-height: calc(100vh - 3rem);
      flex-grow: 1;
    }

    /* Block styling */
    .block {
      background-color: #12140d;
      border-radius: 0.375rem;
      padding: 0.5rem;
      flex-shrink: 0;
      position: relative;
      width: 280px;
      min-width: 280px;
      max-width: 280px;
      display: flex;
      flex-direction: column;
      min-height: 30px;
      height: fit-content;
      overflow: visible;
      margin-bottom: 0.5rem;
    }

    /* Item container styling */
    .block > div:last-child {
      min-height: 0;
      transition: min-height 0.2s ease;
    }

    .block-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 0.5rem;
      position: relative;
    }
    .block-title {
      font-weight: 600;
      font-size: 0.75rem;
      color: white;
      word-break: break-word;
      flex: 1;
    }
    .block-menu-btn {
      color: #6b7280;
      font-size: 0.75rem;
      padding: 0.25rem;
      border-radius: 0.25rem;
      background: transparent;
      border: none;
      cursor: pointer;
      position: relative;
      flex-shrink: 0;
    }
    .block-menu-btn:hover {
      color: white;
      background-color: #2f2f33;
    }

    /* Menu dropdown para blocos */
    .block-dropdown-menu {
      position: absolute;
      top: 100%;
      right: 0;
      margin-top: 0.25rem;
      background-color: #1b1c21;
      border: 1px solid #2f2f33;
      border-radius: 0.375rem;
      box-shadow: 0 4px 8px rgb(0 0 0 / 0.5);
      width: 12rem;
      font-size: 0.75rem;
      display: none;
      flex-direction: column;
      z-index: 10000;
    }
    .block-dropdown-menu button {
      padding: 0.5rem 1rem;
      text-align: left;
      color: #9ca3af;
      background: transparent;
      border: none;
      cursor: pointer;
      width: 100%;
    }
    .block-dropdown-menu button:hover {
      background-color: #2f2f33;
      color: white;
    }

    /* Estilo da tabela inline da planilha */
    .sheet-table-wrapper {
      overflow: auto;
      max-width: 100%;
      flex-grow: 1;
      min-height: 100px;
    }
    table.sheet-table {
      border-collapse: collapse;
      width: 100%;
      font-size: 0.75rem;
      table-layout: fixed;
      word-wrap: break-word;
    }
    table.sheet-table th,
    table.sheet-table td {
      border: 1px solid #2f2f33;
      padding: 0.25rem 0.5rem;
      background-color: #12140d;
      color: white;
      vertical-align: middle;
      overflow-wrap: break-word;
    }
    table.sheet-table th {
      background-color: #2f4a11;
      user-select: none;
    }
    table.sheet-table td[contenteditable="true"] {
      outline: none;
      cursor: text;
    }

    /* Scrollbar para menus dropdown */
    .scrollable-menu {
      max-height: 200px;
      overflow-y: auto;
    }

    /* Ajuste do botão para adicionar novo bloco na barra lateral */
    #addNewBlockBtnSidebar {
      padding: 0.125rem 0.5rem;
      font-size: 0.75rem;
      line-height: 1rem;
      height: 1.75rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }
  </style>
</head>
<body class="bg-[#3b6a2a] font-sans text-white min-h-screen flex flex-col">
  <!-- Top Navbar -->
  <header class="flex items-center justify-between bg-[#1b1c21] px-4 h-12 flex-shrink-0">
    <div class="flex items-center space-x-2">
      <img
        src="https://storage.googleapis.com/a1aa/image/cf0b3528-d36d-4534-785e-71b9b9dc5bb1.jpg"
        alt="Trello logo placeholder, white T on gray background"
        class="w-6 h-6"
        width="24"
        height="24"
      />
      <span class="text-white text-sm font-semibold select-none">Calendário</span>
      <button
        id="btnCreate"
        class="ml-2 bg-[#2f80ed] hover:bg-[#1c5ed6] text-white text-xs font-semibold rounded px-2 py-1 relative"
        type="button"
        aria-haspopup="true"
        aria-expanded="false"
      >
        Criar
      </button>
    </div>
    <div class="flex items-center gap-4">
      <div class="relative">
        <input
          type="search"
          placeholder="Pesquisar"
          class="bg-[#1b1c21] border border-[#2f2f33] rounded text-xs text-white placeholder:text-[#6b7280] py-1 pl-3 pr-8 w-40 focus:outline-none focus:ring-1 focus:ring-[#2f80ed]"
          aria-label="Pesquisar"
        />
        <i
          class="fas fa-search absolute right-2 top-1/2 -translate-y-1/2 text-[#6b7280] text-xs pointer-events-none"
        ></i>
      </div>
      <img
        id="userAvatar"
        src="https://storage.googleapis.com/a1aa/image/15eee078-e569-480c-ee32-55d9667fcb68.jpg"
        alt="User avatar placeholder, white U on gray background"
        class="w-8 h-8 rounded-full cursor-pointer"
        width="32"
        height="32"
        aria-haspopup="true"
        aria-expanded="false"
        aria-label="Configurações do usuário"
      />
    </div>
  </header>

  <!-- Menu de configurações do usuário -->
  <div
    id="userSettingsMenu"
    class="hidden absolute right-0 mt-2 w-64 bg-[#1b1c21] border border-[#2f2f33] rounded shadow-lg z-50"
    role="menu"
    aria-label="Configurações do usuário"
  >
    <div class="p-4 text-xs text-white space-y-3">
      <label class="flex items-center space-x-2 cursor-pointer select-none">
        <input
          type="checkbox"
          id="expandBoardCheckbox"
          class="form-checkbox h-4 w-4 text-[#2f80ed] rounded"
        />
        <span>Expandir quadro conforme o tamanho da planilha</span>
      </label>
    </div>
  </div>

  <main class="flex flex-1 overflow-hidden relative">
    <!-- Left Sidebar -->
    <aside
      id="sidebar"
      class="bg-[#1b1c21] w-60 flex flex-col flex-shrink-0 overflow-y-auto relative"
      aria-label="Barra lateral de quadros"
    >
      <div
        class="flex items-center space-x-2 px-3 py-3 border-b border-[#2f2f33] relative"
        role="banner"
      >
        <div
          class="bg-[#6b7280] text-white font-bold rounded px-2 py-1 text-xs select-none user-initial"
          aria-hidden="true"
          style="user-select:none"
        >
          G
        </div>
      </div>
      <nav
        class="flex flex-col px-3 py-2 text-xs text-[#9ca3af] space-y-2"
        aria-label="Navegação principal"
      >
        <a
          href="#"
          class="flex items-center space-x-2 hover:text-white"
          tabindex="0"
          > <i class="fas fa-columns w-4"></i> <span>Quadros</span> </a
        >
        <div
          id="btnSettings"
          class="flex items-center space-x-2 cursor-pointer hover:text-white select-none"
          tabindex="0"
          role="button"
          aria-haspopup="true"
          aria-expanded="false"
          aria-controls="settingsMenu"
        >
          <i class="fas fa-cog w-4"></i>
          <span>Configurações</span>
          <i class="fas fa-chevron-down ml-auto"></i>
        </div>
        <div
          id="settingsMenu"
          class="hidden flex flex-col mt-1 ml-6 text-xs space-y-1 text-[#9ca3af]"
          role="menu"
          aria-label="Configurações do quadro"
        >
          <label class="flex items-center space-x-2 cursor-pointer select-none">
            <input
              type="checkbox"
              id="settingExpandBoard"
              class="form-checkbox h-4 w-4 text-[#2f80ed] rounded"
            />
            <span>Expandir quadro conforme o tamanho da planilha</span>
          </label>
        </div>
      </nav>
      <div class="px-3 py-2 text-xs text-[#9ca3af] font-semibold select-none flex items-center justify-between">
        <span>Seus quadros</span>
        <button
          id="addNewBlockBtnSidebar"
          aria-label="Adicionar novo quadro"
          title="Adicionar novo quadro"
          class="text-[#6b7280] hover:text-white text-xs p-1 rounded"
          type="button"
        >
          <i class="fas fa-plus"></i>
        </button>
      </div>
      <div
        id="boardsList"
        class="flex flex-col space-y-1 px-3 scrollbar-y"
        aria-live="polite"
        aria-relevant="additions removals"
      >
        <!-- Boards will be dynamically added here -->
      </div>
    </aside>
    <!-- Sidebar toggle button outside sidebar -->
    <button
      id="sidebarToggleBtn"
      aria-label="Alternar barra lateral"
      title="Alternar barra lateral"
      type="button"
    >
      <i class="fas fa-chevron-left"></i>
    </button>

    <!-- Main Content -->
    <section
      class="flex-1 flex flex-col overflow-auto"
      aria-label="Área principal de quadros"
    >
      <header
        id="boardTitle"
        class="bg-[#2f4a11] px-4 py-2 font-semibold text-sm select-none text-center"
        aria-live="polite"
      >
        Selecione ou crie um quadro
      </header>
      <div
        id="boardContent"
        class="flex space-x-4 p-4 overflow-x-auto scrollbar-x"
        tabindex="0"
        aria-label="Conteúdo do quadro"
      >
        <!-- Blocks (antigos cartões) e seus conteúdos -->
      </div>
    </section>
  </main>

  <!-- Create menu below "Criar" button -->
  <div
    id="createMenu"
    class="hidden absolute bg-[#1b1c21] border border-[#2f2f33] rounded shadow-lg mt-1 text-xs text-white w-48 z-50"
    role="menu"
    aria-label="Menu criar"
  >
    <button
      id="addBoardBtn"
      class="w-full text-left px-4 py-2 hover:bg-[#2f2f33] flex items-center space-x-2"
      type="button"
    >
      <i class="fas fa-columns"></i>
      <span>Adicionar novo quadro</span>
    </button>
    <button
      id="addCardBtn"
      class="w-full text-left px-4 py-2 hover:bg-[#2f2f33] flex items-center space-x-2"
      type="button"
    >
      <i class="fas fa-sticky-note"></i>
      <span>Adicionar cartão simples</span>
    </button>
  </div>

  <!-- Modal for editing cards and sheets -->
  <div
    id="modal"
    class="hidden fixed inset-0 flex items-center justify-center modal-bg z-50"
    role="dialog"
    aria-modal="true"
    aria-labelledby="modalTitle"
  >
    <div
      class="bg-[#1b1c21] rounded-md max-w-4xl w-full max-h-[90vh] overflow-auto p-6 relative"
    >
      <header class="flex justify-between items-center mb-4">
        <h2
          id="modalTitle"
          class="text-white font-semibold text-lg select-none"
        >
          Editar
        </h2>
        <div class="flex items-center space-x-2">
          <button
            id="btnMaximize"
            class="text-white hover:text-[#2f80ed]"
            title="Maximizar"
            type="button"
            aria-label="Maximizar modal"
          >
            <i class="fas fa-expand"></i>
          </button>
          <button
            id="btnRestore"
            class="text-white hover:text-[#2f80ed] hidden"
            title="Restaurar"
            type="button"
            aria-label="Restaurar modal"
          >
            <i class="fas fa-compress"></i>
          </button>
          <button
            id="btnCloseModal"
            class="text-white hover:text-red-600"
            title="Fechar"
            type="button"
            aria-label="Fechar modal"
          >
            <i class="fas fa-times"></i>
          </button>
        </div>
      </header>
      <div id="modalContent" class="text-white text-sm overflow-auto max-h-[70vh]">
        <!-- Dynamic content for editing card or sheet -->
      </div>
      <footer class="mt-4 flex justify-end space-x-3">
        <button
          id="btnDelete"
          class="bg-red-600 hover:bg-red-700 px-3 py-1 rounded text-xs font-semibold"
          type="button"
        >
          🗑️ Excluir
        </button>
        <button
          id="btnArchive"
          class="bg-gray-600 hover:bg-gray-700 px-3 py-1 rounded text-xs font-semibold"
          type="button"
        >
          📦 Arquivar
        </button>
      </footer>
    </div>
  </div>

  <script>
    // Elementos do DOM
    const btnCreate = document.getElementById("btnCreate");
    const createMenu = document.getElementById("createMenu");
    const addBoardBtn = document.getElementById("addBoardBtn");
    const addCardBtn = document.getElementById("addCardBtn");
    const boardsList = document.getElementById("boardsList");
    const boardTitle = document.getElementById("boardTitle");
    const boardContent = document.getElementById("boardContent");
    const modal = document.getElementById("modal");
    const modalContent = document.getElementById("modalContent");
    const btnCloseModal = document.getElementById("btnCloseModal");
    const btnDelete = document.getElementById("btnDelete");
    const btnArchive = document.getElementById("btnArchive");
    const btnMaximize = document.getElementById("btnMaximize");
    const btnRestore = document.getElementById("btnRestore");
    const userAvatar = document.getElementById("userAvatar");
    const userSettingsMenu = document.getElementById("userSettingsMenu");
    const settingExpandBoard = document.getElementById("expandBoardCheckbox");
    const btnSettings = document.getElementById("btnSettings");
    const settingsMenu = document.getElementById("settingsMenu");
    const settingExpandBoardSidebar = document.getElementById("settingExpandBoard");
    const sidebar = document.getElementById("sidebar");
    const sidebarToggleBtn = document.getElementById("sidebarToggleBtn");

    // Função utilitária para gerar IDs únicos
    function generateId() {
      return Date.now().toString(36) + Math.random().toString(36).substr(2, 5);
    }

    // Estrutura de dados principal
    let boards = [];
    let selectedBoardId = null;
    let selectedItem = null;
    let expandBoard = false;
    let sidebarCollapsed = false;

    // Função para criar um bloco visual
    function createBlockElement(block, board) {
      const blockEl = document.createElement("div");
      blockEl.className = "block";
      blockEl.setAttribute("tabindex", "0");
      blockEl.setAttribute("role", "region");
      blockEl.setAttribute("aria-label", `Bloco: ${block.name}`);

      // Container para itens dentro do bloco
      const itemsContainer = document.createElement("div");
      itemsContainer.className = "flex-1 space-y-2";
      itemsContainer.style.minHeight = "0";
      itemsContainer.style.transition = "min-height 0.2s ease";

      // Cabeçalho com nome do bloco e botão de menu
      const header = document.createElement("div");
      header.className = "block-header";

      const titleSpan = document.createElement("span");
      titleSpan.className = "block-title";
      titleSpan.textContent = block.name;

      // Botão de menu
      const menuBtn = document.createElement("button");
      menuBtn.className = "block-menu-btn";
      menuBtn.type = "button";
      menuBtn.setAttribute("aria-haspopup", "true");
      menuBtn.setAttribute("aria-expanded", "false");
      menuBtn.setAttribute("aria-label", `Menu do bloco ${block.name}`);
      menuBtn.innerHTML = '<i class="fas fa-ellipsis-h"></i>';

      // Menu dropdown para opções do bloco
      const menuDropdown = document.createElement("div");
      menuDropdown.className = "block-dropdown-menu";
      menuDropdown.setAttribute("role", "menu");
      menuDropdown.setAttribute("aria-label", `Opções do bloco ${block.name}`);

      // Opção de editar nome
      const editOption = document.createElement("button");
      editOption.type = "button";
      editOption.textContent = "Editar nome";
      editOption.addEventListener("click", () => {
        closeAllMenus();
        const newName = prompt("Digite o novo nome do bloco:", block.name);
        if (newName && newName.trim() !== "") {
          block.name = newName.trim();
          renderBoardContent();
        }
      });

      // Opção de adicionar planilha
      const addSheetOption = document.createElement("button");
      addSheetOption.type = "button";
      addSheetOption.textContent = "+ Nova planilha";
      addSheetOption.addEventListener("click", () => {
        closeAllMenus();
        addNewSheetToBlock(block);
      });

      // Opção de adicionar cartão simples
      const addCardOption = document.createElement("button");
      addCardOption.type = "button";
      addCardOption.textContent = "+ Novo cartão simples";
      addCardOption.addEventListener("click", () => {
        closeAllMenus();
        addNewCardToBlock(block);
      });

      // Opção de arquivar
      const archiveOption = document.createElement("button");
      archiveOption.type = "button";
      archiveOption.textContent = "Arquivar";
      archiveOption.addEventListener("click", () => {
        block.archived = true;
        renderBoardContent();
      });

      // Opção de excluir
      const deleteOption = document.createElement("button");
      deleteOption.type = "button";
      deleteOption.textContent = "Excluir";
      deleteOption.addEventListener("click", () => {
        if (confirm(`Tem certeza que deseja excluir o bloco "${block.name}"? Essa ação não pode ser desfeita.`)) {
          const idx = board.blocks.findIndex(b => b.id === block.id);
          if (idx > -1) {
            board.blocks.splice(idx, 1);
            renderBoardContent();
            closeModal();
          }
        }
      });

      menuDropdown.appendChild(editOption);
      menuDropdown.appendChild(addSheetOption);
      menuDropdown.appendChild(addCardOption);
      menuDropdown.appendChild(archiveOption);
      menuDropdown.appendChild(deleteOption);

      menuBtn.appendChild(menuDropdown);

      menuBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        const expanded = menuBtn.getAttribute("aria-expanded") === "true";
        closeAllMenus();
        if (!expanded) {
          menuDropdown.style.display = "flex";
          menuDropdown.style.top = menuBtn.offsetHeight + "px";
          menuDropdown.style.right = "0";
          menuBtn.setAttribute("aria-expanded", "true");
        }
      });

      header.appendChild(titleSpan);
      header.appendChild(menuBtn);
      blockEl.appendChild(header);

      // Renderiza itens do bloco
      block.items.forEach(item => {
        if (item.archived) return;
        if (item.type === "card") {
          itemsContainer.appendChild(createCardElement(item, block, board));
        } else if (item.type === "sheet") {
          itemsContainer.appendChild(createSheetElement(item, block, board));
        }
      });

      blockEl.appendChild(itemsContainer);
      return blockEl;
    }

    // Função para criar elemento de cartão
    function createCardElement(card, block, board) {
      const cardEl = document.createElement("div");
      cardEl.className = "bg-[#1e1f22] rounded-md p-3 select-none relative cursor-pointer";
      cardEl.setAttribute("tabindex", "0");
      cardEl.setAttribute("role", "button");
      cardEl.setAttribute("aria-label", `Cartão simples: ${card.title}`);

      const header = document.createElement("div");
      header.className = "flex justify-between items-start";

      const titleSpan = document.createElement("span");
      titleSpan.className = "font-semibold text-xs text-white break-words flex-1";
      titleSpan.textContent = card.title;

      // Botão de menu
      const menuBtn = document.createElement("button");
      menuBtn.className = "text-[#6b7280] hover:text-white text-xs p-1 rounded";
      menuBtn.type = "button";
      menuBtn.setAttribute("aria-haspopup", "true");
      menuBtn.setAttribute("aria-expanded", "false");
      menuBtn.setAttribute("aria-label", `Menu do cartão simples ${card.title}`);
      menuBtn.innerHTML = `<i class="fas fa-ellipsis-h"></i>`;
      menuBtn.style.position = "relative";

      // Menu dropdown para opções do cartão
      const menuDropdown = document.createElement("div");
      menuDropdown.className = "block-dropdown-menu";
      menuDropdown.setAttribute("role", "menu");
      menuDropdown.setAttribute("aria-label", `Opções do cartão simples ${card.title}`);

      const editOption = document.createElement("button");
      editOption.type = "button";
      editOption.textContent = "Editar";
      editOption.addEventListener("click", () => {
        closeAllMenus();
        openModal("card", card, block, board);
      });

      const archiveOption = document.createElement("button");
      archiveOption.type = "button";
      archiveOption.textContent = "Arquivar";
      archiveOption.addEventListener("click", () => {
        card.archived = true;
        renderBoardContent();
      });

      const deleteOption = document.createElement("button");
      deleteOption.type = "button";
      deleteOption.textContent = "Excluir";
      deleteOption.addEventListener("click", () => {
        const idx = block.items.findIndex(i => i.id === card.id);
        if (idx > -1) {
          block.items.splice(idx, 1);
          renderBoardContent();
          closeModal();
        }
      });

      menuDropdown.appendChild(editOption);
      menuDropdown.appendChild(archiveOption);
      menuDropdown.appendChild(deleteOption);
      menuBtn.appendChild(menuDropdown);

      menuBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        const expanded = menuBtn.getAttribute("aria-expanded") === "true";
        closeAllMenus();
        if (!expanded) {
          menuDropdown.style.display = "flex";
          menuDropdown.style.top = menuBtn.offsetHeight + "px";
          menuDropdown.style.right = "0";
          menuBtn.setAttribute("aria-expanded", "true");
        }
      });

      header.appendChild(titleSpan);
      header.appendChild(menuBtn);
      cardEl.appendChild(header);

      // Clique no cartão abre modal de edição (exceto no botão de menu)
      cardEl.addEventListener("click", (e) => {
        if (e.target === menuBtn || menuBtn.contains(e.target)) return;
        openModal("card", card, block, board);
      });

      return cardEl;
    }

    // Função para criar elemento de planilha
    function createSheetElement(sheet, block, board) {
      const sheetEl = document.createElement("div");
      sheetEl.className = "bg-[#1e1f22] rounded-md p-3 select-none relative cursor-pointer";
      sheetEl.setAttribute("tabindex", "0");
      sheetEl.setAttribute("role", "button");
      sheetEl.setAttribute("aria-label", `Planilha: ${sheet.name || "Sem nome"}`);

      const header = document.createElement("div");
      header.className = "flex justify-between items-start";

      const titleSpan = document.createElement("span");
      titleSpan.className = "font-semibold text-xs text-white break-words flex-1";
      titleSpan.textContent = sheet.name || "Planilha";

      // Botão de menu
      const menuBtn = document.createElement("button");
      menuBtn.className = "text-[#6b7280] hover:text-white text-xs p-1 rounded";
      menuBtn.type = "button";
      menuBtn.setAttribute("aria-haspopup", "true");
      menuBtn.setAttribute("aria-expanded", "false");
      menuBtn.setAttribute("aria-label", `Menu da planilha ${sheet.name || "Sem nome"}`);
      menuBtn.innerHTML = `<i class="fas fa-ellipsis-h"></i>`;
      menuBtn.style.position = "relative";

      // Menu dropdown para opções da planilha
      const menuDropdown = document.createElement("div");
      menuDropdown.className = "block-dropdown-menu";
      menuDropdown.setAttribute("role", "menu");
      menuDropdown.setAttribute("aria-label", `Opções da planilha ${sheet.name || "Sem nome"}`);

      const editOption = document.createElement("button");
      editOption.type = "button";
      editOption.textContent = "Editar";
      editOption.addEventListener("click", () => {
        closeAllMenus();
        openModal("sheet", sheet, block, board);
      });

      const archiveOption = document.createElement("button");
      archiveOption.type = "button";
      archiveOption.textContent = "Arquivar";
      archiveOption.addEventListener("click", () => {
        sheet.archived = true;
        renderBoardContent();
      });

      const deleteOption = document.createElement("button");
      deleteOption.type = "button";
      deleteOption.textContent = "Excluir";
      deleteOption.addEventListener("click", () => {
        const idx = block.items.findIndex(i => i.id === sheet.id);
        if (idx > -1) {
          block.items.splice(idx, 1);
          renderBoardContent();
          closeModal();
        }
      });

      menuDropdown.appendChild(editOption);
      menuDropdown.appendChild(archiveOption);
      menuDropdown.appendChild(deleteOption);
      menuBtn.appendChild(menuDropdown);

      menuBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        const expanded = menuBtn.getAttribute("aria-expanded") === "true";
        closeAllMenus();
        if (!expanded) {
          menuDropdown.style.display = "flex";
          menuDropdown.style.top = menuBtn.offsetHeight + "px";
          menuDropdown.style.right = "0";
          menuBtn.setAttribute("aria-expanded", "true");
        }
      });

      header.appendChild(titleSpan);
      header.appendChild(menuBtn);
      sheetEl.appendChild(header);

      // Clique na planilha abre modal de edição (exceto no botão de menu)
      sheetEl.addEventListener("click", (e) => {
        if (e.target === menuBtn || menuBtn.contains(e.target)) return;
        openModal("sheet", sheet, block, board);
      });

      // Renderiza tabela inline
      if (sheet.columns && sheet.data) {
        const tableWrapper = document.createElement("div");
        tableWrapper.className = "sheet-table-wrapper mt-2";

        const table = document.createElement("table");
        table.className = "sheet-table";

        // Cabeçalho da tabela
        const thead = document.createElement("thead");
        const trHead = document.createElement("tr");
        sheet.columns.forEach(col => {
          const th = document.createElement("th");
          th.textContent = col.name;
          trHead.appendChild(th);
        });
        thead.appendChild(trHead);
        table.appendChild(thead);

        // Corpo da tabela
        const tbody = document.createElement("tbody");
        sheet.data.forEach((row, rowIndex) => {
          const tr = document.createElement("tr");
          sheet.columns.forEach((col, colIndex) => {
            const td = document.createElement("td");
            td.setAttribute("contenteditable", "true");
            td.setAttribute("data-row", rowIndex);
            td.setAttribute("data-col", colIndex);
            td.textContent = row[colIndex] ?? "";
            td.addEventListener("input", (e) => {
              sheet.data[rowIndex][colIndex] = e.target.textContent;
            });
            tr.appendChild(td);
          });
          tbody.appendChild(tr);
        });
        table.appendChild(tbody);
        tableWrapper.appendChild(table);
        sheetEl.appendChild(tableWrapper);
      }

      return sheetEl;
    }

    // Função para renderizar lista de quadros na barra lateral
    function renderBoardsList() {
      if (!boardsList) return;

      boardsList.innerHTML = "";
      boards.forEach(board => {
        const isSelected = board.id === selectedBoardId;
        const boardEl = document.createElement("div");
        boardEl.className = `flex items-center justify-between rounded px-2 py-1 text-xs cursor-pointer ${
          isSelected ? "bg-[#6b7280]/30 text-white" : "text-[#9ca3af] hover:text-white"
        }`;

        const leftDiv = document.createElement("div");
        leftDiv.className = "flex items-center space-x-2";
        
        const colorBox = document.createElement("div");
        colorBox.className = "w-3 h-3 rounded-sm bg-[#6b7280]";
        
        const nameSpan = document.createElement("span");
        nameSpan.textContent = board.name;
        nameSpan.className = "board-name";
        
        leftDiv.appendChild(colorBox);
        leftDiv.appendChild(nameSpan);
        boardEl.appendChild(leftDiv);

        // Botão de menu com três pontinhos
        const menuBtn = document.createElement("button");
        menuBtn.className = "text-[#6b7280] hover:text-white text-xs p-1 rounded";
        menuBtn.type = "button";
        menuBtn.setAttribute("aria-haspopup", "true");
        menuBtn.setAttribute("aria-expanded", "false");
        menuBtn.setAttribute("aria-label", `Menu do quadro ${board.name}`);
        menuBtn.innerHTML = `<i class="fas fa-ellipsis-h"></i>`;
        menuBtn.style.position = "relative";

        // Menu dropdown para opções do quadro
        const menuDropdown = document.createElement("div");
        menuDropdown.className = "dropdown-menu";
        menuDropdown.setAttribute("role", "menu");
        menuDropdown.setAttribute("aria-label", `Opções do quadro ${board.name}`);

        // Opção de editar
        const editOption = document.createElement("button");
        editOption.type = "button";
        editOption.textContent = "Editar nome";
        editOption.addEventListener("click", () => {
          closeAllMenus();
          const newName = prompt("Digite o novo nome do quadro:", board.name);
          if (newName && newName.trim() !== "") {
            board.name = newName.trim();
            renderBoardsList();
            if (selectedBoardId === board.id) {
              renderBoardContent();
            }
          }
        });

        // Opção de excluir
        const deleteOption = document.createElement("button");
        deleteOption.type = "button";
        deleteOption.textContent = "Excluir quadro";
        deleteOption.addEventListener("click", () => {
          if (confirm(`Tem certeza que deseja excluir o quadro "${board.name}"? Essa ação não pode ser desfeita.`)) {
            const idx = boards.findIndex(b => b.id === board.id);
            if (idx > -1) {
              boards.splice(idx, 1);
              if (selectedBoardId === board.id) {
                selectedBoardId = boards.length ? boards[0].id : null;
              }
              renderBoardsList();
              renderBoardContent();
              closeModal();
            }
          }
        });

        menuDropdown.appendChild(editOption);
        menuDropdown.appendChild(deleteOption);
        menuBtn.appendChild(menuDropdown);

        menuBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          const expanded = menuBtn.getAttribute("aria-expanded") === "true";
          closeAllMenus();
          if (!expanded) {
            menuDropdown.style.display = "flex";
            menuDropdown.style.top = menuBtn.offsetHeight + "px";
            menuDropdown.style.right = "0";
            menuBtn.setAttribute("aria-expanded", "true");
          }
        });

        boardEl.appendChild(menuBtn);

        // Seleciona quadro ao clicar fora do menu
        boardEl.addEventListener("click", (e) => {
          if (e.target === menuBtn || menuBtn.contains(e.target)) return;
          selectedBoardId = board.id;
          renderBoardsList();
          renderBoardContent();
        });

        boardsList.appendChild(boardEl);
      });
    }

    // Função para fechar todos os menus
    function closeAllMenus() {
      document.querySelectorAll("[aria-expanded='true']").forEach(el => {
        el.setAttribute("aria-expanded", "false");
      });
      document.querySelectorAll(".dropdown-menu, .block-dropdown-menu").forEach(menu => {
        menu.style.display = "none";
      });
    }

    // Função para abrir modal
    function openModal(type, item, block, board) {
      selectedItem = { type, item, block, board };
      modal.classList.remove("hidden");
      
      const title = type === "card" ? item.title : item.name;
      document.getElementById("modalTitle").textContent = title;
      renderModalContent(type, item, block, board);
    }

    // Função para renderizar conteúdo do modal
    function renderModalContent(type, item, block, board) {
      modalContent.innerHTML = "";
      if (type === "card") {
        renderCardModal(item);
      } else if (type === "sheet") {
        renderSheetModal(item);
      }
    }

    // Função para renderizar modal de cartão
    function renderCardModal(card) {
      const container = document.createElement("div");
      container.className = "space-y-4";

      // Input do título
      const titleLabel = document.createElement("label");
      titleLabel.className = "block text-xs font-semibold mb-1";
      titleLabel.textContent = "Título";
      const titleInput = document.createElement("input");
      titleInput.type = "text";
      titleInput.value = card.title;
      titleInput.className = "w-full rounded bg-[#2f4a11] border border-[#2f80ed] px-2 py-1 text-white text-sm focus:outline-none focus:ring-1 focus:ring-[#2f80ed]";
      titleInput.addEventListener("input", (e) => {
        card.title = e.target.value;
        renderBoardsList();
        renderBoardContent();
      });

      // Textarea da descrição
      const descLabel = document.createElement("label");
      descLabel.className = "block text-xs font-semibold mb-1";
      descLabel.textContent = "Descrição";
      const descTextarea = document.createElement("textarea");
      descTextarea.value = card.description || "";
      descTextarea.rows = 4;
      descTextarea.className = "w-full rounded bg-[#2f4a11] border border-[#2f80ed] px-2 py-1 text-white text-sm resize-none focus:outline-none focus:ring-1 focus:ring-[#2f80ed]";
      descTextarea.addEventListener("input", (e) => {
        card.description = e.target.value;
      });

      // Checklist
      const checklistLabel = document.createElement("label");
      checklistLabel.className = "block text-xs font-semibold mb-1";
      checklistLabel.textContent = "Checklist";

      const checklistContainer = document.createElement("div");
      checklistContainer.className = "space-y-1 max-h-40 overflow-auto";

      function renderChecklist() {
        checklistContainer.innerHTML = "";
        card.checklist.forEach((item, idx) => {
          const itemDiv = document.createElement("div");
          itemDiv.className = "flex items-center space-x-2";

          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.checked = item.checked || false;
          checkbox.className = "cursor-pointer";
          checkbox.addEventListener("change", () => {
            card.checklist[idx].checked = checkbox.checked;
          });

          const textInput = document.createElement("input");
          textInput.type = "text";
          textInput.value = item.text || "";
          textInput.className = "flex-1 bg-[#2f4a11] border border-[#2f80ed] rounded px-2 py-1 text-white text-sm focus:outline-none focus:ring-1 focus:ring-[#2f80ed]";
          textInput.addEventListener("input", (e) => {
            card.checklist[idx].text = e.target.value;
          });

          const delBtn = document.createElement("button");
          delBtn.type = "button";
          delBtn.className = "text-red-600 hover:text-red-800 text-sm px-1 rounded";
          delBtn.title = "Remover item";
          delBtn.innerHTML = '<i class="fas fa-times"></i>';
          delBtn.addEventListener("click", () => {
            card.checklist.splice(idx, 1);
            renderChecklist();
          });

          itemDiv.appendChild(checkbox);
          itemDiv.appendChild(textInput);
          itemDiv.appendChild(delBtn);
          checklistContainer.appendChild(itemDiv);
        });
      }
      renderChecklist();

      const addChecklistBtn = document.createElement("button");
      addChecklistBtn.type = "button";
      addChecklistBtn.className = "mt-1 bg-[#6b7280]/40 hover:bg-[#6b7280]/60 rounded px-2 py-1 text-xs font-semibold flex items-center space-x-1";
      addChecklistBtn.innerHTML = `<i class="fas fa-plus"></i><span>Adicionar item</span>`;
      addChecklistBtn.addEventListener("click", () => {
        card.checklist.push({ text: "", checked: false });
        renderChecklist();
      });

      container.appendChild(titleLabel);
      container.appendChild(titleInput);
      container.appendChild(descLabel);
      container.appendChild(descTextarea);
      container.appendChild(checklistLabel);
      container.appendChild(checklistContainer);
      container.appendChild(addChecklistBtn);

      modalContent.appendChild(container);
    }

    // Função para renderizar modal de planilha
    function renderSheetModal(sheet) {
      const container = document.createElement("div");
      container.className = "space-y-4";

      // Input do nome da planilha
      const nameLabel = document.createElement("label");
      nameLabel.className = "block text-xs font-semibold mb-1";
      nameLabel.textContent = "Nome da planilha";
      const nameInput = document.createElement("input");
      nameInput.type = "text";
      nameInput.value = sheet.name || "";
      nameInput.className = "w-full rounded bg-[#2f4a11] border border-[#2f80ed] px-2 py-1 text-white text-sm focus:outline-none focus:ring-1 focus:ring-[#2f80ed]";
      nameInput.addEventListener("input", (e) => {
        sheet.name = e.target.value;
        renderBoardContent();
      });

      // Gerenciamento de colunas
      const columnsLabel = document.createElement("label");
      columnsLabel.className = "block text-xs font-semibold mb-1";
      columnsLabel.textContent = "Colunas";

      const columnsContainer = document.createElement("div");
      columnsContainer.className = "space-y-2 max-h-40 overflow-auto";

      function renderColumns() {
        columnsContainer.innerHTML = "";
        sheet.columns.forEach((col, idx) => {
          const colDiv = document.createElement("div");
          colDiv.className = "flex items-center space-x-2";

          const colNameInput = document.createElement("input");
          colNameInput.type = "text";
          colNameInput.value = col.name;
          colNameInput.className = "flex-1 bg-[#2f4a11] border border-[#2f80ed] rounded px-2 py-1 text-white text-sm focus:outline-none focus:ring-1 focus:ring-[#2f80ed]";
          colNameInput.addEventListener("input", (e) => {
            sheet.columns[idx].name = e.target.value;
            renderBoardContent();
          });

          const colTypeSelect = document.createElement("select");
          colTypeSelect.className = "bg-[#2f4a11] border border-[#2f80ed] rounded px-2 py-1 text-white text-sm focus:outline-none focus:ring-1 focus:ring-[#2f80ed]";
          const types = ["Texto", "Número", "Moeda (R$)", "Data", "Hora", "Tempo/Duração", "Porcentagem", "Checkbox", "Peso (kg)", "Outro"];
          types.forEach(t => {
            const option = document.createElement("option");
            option.value = t.toLowerCase();
            option.textContent = t;
            if (col.type === t.toLowerCase()) option.selected = true;
            colTypeSelect.appendChild(option);
          });
          colTypeSelect.addEventListener("change", (e) => {
            sheet.columns[idx].type = e.target.value;
          });

          const delBtn = document.createElement("button");
          delBtn.type = "button";
          delBtn.className = "text-red-600 hover:text-red-800 text-sm px-1 rounded";
          delBtn.title = "Remover coluna";
          delBtn.innerHTML = '<i class="fas fa-times"></i>';
          delBtn.addEventListener("click", () => {
            sheet.columns.splice(idx, 1);
            sheet.data.forEach(row => {
              row.splice(idx, 1);
            });
            renderColumns();
            renderBoardContent();
          });

          colDiv.appendChild(colNameInput);
          colDiv.appendChild(colTypeSelect);
          colDiv.appendChild(delBtn);
          columnsContainer.appendChild(colDiv);
        });
      }
      renderColumns();

      const addColumnBtn = document.createElement("button");
      addColumnBtn.type = "button";
      addColumnBtn.className = "mt-1 bg-[#6b7280]/40 hover:bg-[#6b7280]/60 rounded px-2 py-1 text-xs font-semibold flex items-center space-x-1";
      addColumnBtn.innerHTML = `<i class="fas fa-plus"></i><span>Adicionar coluna</span>`;
      addColumnBtn.addEventListener("click", () => {
        sheet.columns.push({ name: `Coluna ${sheet.columns.length + 1}`, type: "text" });
        sheet.data.forEach(row => {
          row.push("");
        });
        renderColumns();
        renderBoardContent();
      });

      // Gerenciamento de linhas
      const rowsLabel = document.createElement("label");
      rowsLabel.className = "block text-xs font-semibold mb-1";
      rowsLabel.textContent = "Linhas";

      const rowsContainer = document.createElement("div");
      rowsContainer.className = "space-y-2 max-h-40 overflow-auto";

      function renderRows() {
        rowsContainer.innerHTML = "";
        sheet.data.forEach((row, idx) => {
          const rowDiv = document.createElement("div");
          rowDiv.className = "flex items-center space-x-2";

          const rowLabel = document.createElement("span");
          rowLabel.className = "text-white text-sm select-none w-6";
          rowLabel.textContent = idx + 1;

          const delBtn = document.createElement("button");
          delBtn.type = "button";
          delBtn.className = "text-red-600 hover:text-red-800 text-sm px-1 rounded";
          delBtn.title = "Remover linha";
          delBtn.innerHTML = '<i class="fas fa-times"></i>';
          delBtn.addEventListener("click", () => {
            sheet.data.splice(idx, 1);
            renderRows();
            renderBoardContent();
          });

          rowDiv.appendChild(rowLabel);
          rowDiv.appendChild(delBtn);
          rowsContainer.appendChild(rowDiv);
        });
      }
      renderRows();

      const addRowBtn = document.createElement("button");
      addRowBtn.type = "button";
      addRowBtn.className = "mt-1 bg-[#6b7280]/40 hover:bg-[#6b7280]/60 rounded px-2 py-1 text-xs font-semibold flex items-center space-x-1";
      addRowBtn.innerHTML = `<i class="fas fa-plus"></i><span>Adicionar linha</span>`;
      addRowBtn.addEventListener("click", () => {
        const newRow = sheet.columns.map(() => "");
        sheet.data.push(newRow);
        renderRows();
        renderBoardContent();
      });

      container.appendChild(nameLabel);
      container.appendChild(nameInput);
      container.appendChild(columnsLabel);
      container.appendChild(columnsContainer);
      container.appendChild(addColumnBtn);
      container.appendChild(rowsLabel);
      container.appendChild(rowsContainer);
      container.appendChild(addRowBtn);

      modalContent.appendChild(container);
    }

    // Event listeners para menus
    btnCreate.addEventListener("click", (e) => {
      e.stopPropagation();
      const isHidden = createMenu.classList.contains("hidden");
      if (isHidden) {
        const rect = btnCreate.getBoundingClientRect();
        createMenu.style.top = `${rect.bottom + window.scrollY + 4}px`;
        createMenu.style.left = `${rect.left + window.scrollX}px`;
        createMenu.classList.remove("hidden");
        btnCreate.setAttribute("aria-expanded", "true");
      } else {
        createMenu.classList.add("hidden");
        btnCreate.setAttribute("aria-expanded", "false");
      }
    });

    // Fechar menus ao clicar fora
    document.addEventListener("click", () => {
      createMenu.classList.add("hidden");
      btnCreate.setAttribute("aria-expanded", "false");
      userSettingsMenu.classList.add("hidden");
      closeAllMenus();
    });

    // Função para renderizar o conteúdo do quadro
    function renderBoardContent() {
      boardContent.innerHTML = "";
      if (!selectedBoardId) {
        boardTitle.textContent = "Selecione ou crie um quadro";
        return;
      }
      const board = boards.find((b) => b.id === selectedBoardId);
      if (!board) return;
      boardTitle.textContent = board.name;

      // Each block is a container of sheets and cards
      board.blocks.forEach((block) => {
        if (block.archived) return; // skip archived
        boardContent.appendChild(createBlockElement(block, board));
      });

      // Add new block button (versão simplificada)
      const addBlockBtn = document.createElement("button");
      addBlockBtn.className = "bg-[#6b7280]/40 hover:bg-[#6b7280]/60 rounded-md px-3 text-xs font-semibold flex items-center space-x-2 flex-shrink-0 select-none h-7";
      addBlockBtn.type = "button";
      addBlockBtn.innerHTML = `<i class="fas fa-plus"></i><span>Adicionar novo bloco</span>`;
      
      // Adiciona o evento de clique direto para criar novo bloco
      addBlockBtn.addEventListener("click", () => {
        addNewBlock(board);
      });

      boardContent.appendChild(addBlockBtn);
    }

    // Função para inicializar dados de exemplo
    function initExampleData() {
      boards = [
        {
          id: generateId(),
          name: "SAÚDE",
          blocks: [
            {
              id: generateId(),
              name: "Saúde",
              items: [
                {
                  id: generateId(),
                  type: "sheet",
                  name: "Peso e Treino",
                  columns: [
                    { name: "Data", type: "date" },
                    { name: "Peso (kg)", type: "peso (kg)" },
                    { name: "Treino feito (☑️)", type: "checkbox" },
                  ],
                  data: [
                    ["2024-06-01", "70", "true"],
                    ["2024-06-02", "69.5", "false"],
                  ],
                  archived: false,
                },
              ],
              archived: false,
            },
          ],
        },
        {
          id: generateId(),
          name: "DINHEIRO",
          blocks: [
            {
              id: generateId(),
              name: "Dinheiro",
              items: [
                {
                  id: generateId(),
                  type: "sheet",
                  name: "Gastos",
                  columns: [
                    { name: "Data", type: "date" },
                    { name: "Descrição", type: "text" },
                    { name: "Valor (R$)", type: "moeda (r$)" },
                  ],
                  data: [
                    ["2024-06-01", "Supermercado", "150.00"],
                    ["2024-06-02", "Transporte", "20.00"],
                  ],
                  archived: false,
                },
              ],
              archived: false,
            },
          ],
        },
        {
          id: generateId(),
          name: "ESPIRITUAL",
          blocks: [
            {
              id: generateId(),
              name: "Espiritual",
              items: [
                {
                  id: generateId(),
                  type: "card",
                  title: "Checklist de oração",
                  description: "Oração, leitura bíblica, jejum",
                  checklist: [
                    { text: "Oração", checked: false },
                    { text: "Leitura bíblica", checked: false },
                    { text: "Jejum", checked: false },
                  ],
                  archived: false,
                },
              ],
              archived: false,
            },
          ],
        },
      ];

      selectedBoardId = boards[0].id;
      renderBoardsList();
      renderBoardContent();
    }

    // Event listeners principais
    addBoardBtn.addEventListener("click", () => {
      const boardName = prompt("Digite o nome do novo quadro:");
      if (boardName && boardName.trim()) {
        const newBoard = {
          id: generateId(),
          name: boardName.trim(),
          blocks: [],
        };
        boards.push(newBoard);
        selectedBoardId = newBoard.id;
        renderBoardsList();
        renderBoardContent();
      }
    });

    // Botão de configurações
    btnSettings.addEventListener("click", (e) => {
      e.stopPropagation();
      const isHidden = settingsMenu.classList.contains("hidden");
      if (isHidden) {
        settingsMenu.classList.remove("hidden");
        btnSettings.setAttribute("aria-expanded", "true");
      } else {
        settingsMenu.classList.add("hidden");
        btnSettings.setAttribute("aria-expanded", "false");
      }
    });

    // Botão de alternância da barra lateral
    sidebarToggleBtn.addEventListener("click", () => {
      sidebarCollapsed = !sidebarCollapsed;
      if (sidebarCollapsed) {
        sidebar.classList.add("sidebar-collapsed");
        sidebarToggleBtn.style.left = "0";
        sidebarToggleBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
      } else {
        sidebar.classList.remove("sidebar-collapsed");
        sidebarToggleBtn.style.left = "15rem";
        sidebarToggleBtn.innerHTML = '<i class="fas fa-chevron-left"></i>';
      }
    });

    // Funções para manipulação de blocos
    function addNewBlock(board) {
      const blockName = prompt("Digite o nome do novo bloco:");
      if (blockName && blockName.trim()) {
        const newBlock = {
          id: generateId(),
          name: blockName.trim(),
          items: [],
          archived: false,
        };
        board.blocks.push(newBlock);
        renderBoardContent();
      }
    }

    // Função para fechar o modal
    function closeModal() {
      modal.classList.add("hidden");
      selectedItem = null;
      modalContent.innerHTML = "";
      btnDelete.classList.remove("hidden");
      btnArchive.classList.remove("hidden");
      btnMaximize.classList.remove("hidden");
      btnRestore.classList.add("hidden");
    }

    // Funções para gerenciar blocos, cartões e planilhas
    function addNewSheetToBlock(block) {
      const sheetName = prompt("Digite o nome da planilha:");
      if (!sheetName || sheetName.trim() === "") return;
      
      const newSheet = {
        id: generateId(),
        type: "sheet",
        name: sheetName.trim(),
        columns: [
          { name: "Coluna 1", type: "text" },
          { name: "Coluna 2", type: "text" },
          { name: "Coluna 3", type: "text" },
        ],
        data: [
          ["", "", ""],
          ["", "", ""],
          ["", "", ""],
        ],
        archived: false,
      };
      block.items.push(newSheet);
      renderBoardContent();
    }

    function addNewCardToBlock(block) {
      const cardTitle = prompt("Digite o título do cartão simples:");
      if (!cardTitle || cardTitle.trim() === "") return;
      
      const newCard = {
        id: generateId(),
        type: "card",
        title: cardTitle.trim(),
        description: "",
        checklist: [],
        archived: false,
      };
      block.items.push(newCard);
      renderBoardContent();
    }

    // Event listeners do modal
    btnCloseModal.addEventListener("click", closeModal);

    // Modal maximize/restore
    btnMaximize.addEventListener("click", () => {
      modal.querySelector("div").classList.add("fixed", "inset-0", "m-0", "max-w-full", "max-h-full", "rounded-none", "p-6", "overflow-auto");
      btnMaximize.classList.add("hidden");
      btnRestore.classList.remove("hidden");
    });

    btnRestore.addEventListener("click", () => {
      modal.querySelector("div").classList.remove("fixed", "inset-0", "m-0", "max-w-full", "max-h-full", "rounded-none", "p-6", "overflow-auto");
      btnMaximize.classList.remove("hidden");
      btnRestore.classList.add("hidden");
    });

    // Modal delete button
    btnDelete.addEventListener("click", () => {
      if (!selectedItem) return;
      const { type, item, block, board } = selectedItem;
      if (confirm(`Tem certeza que deseja excluir ${type === "card" ? "este cartão" : "esta planilha"}? Essa ação não pode ser desfeita.`)) {
        const idx = block.items.findIndex(i => i.id === item.id);
        if (idx > -1) {
          block.items.splice(idx, 1);
          renderBoardContent();
          closeModal();
        }
      }
    });

    // Modal archive button
    btnArchive.addEventListener("click", () => {
      if (!selectedItem) return;
      const { item } = selectedItem;
      if (confirm(`Tem certeza que deseja arquivar ${item.type === "card" ? "este cartão" : "esta planilha"}?`)) {
        item.archived = true;
        renderBoardContent();
        closeModal();
      }
    });

    // Inicializa a aplicação
    initExampleData();
  </script>
</body>
</html>